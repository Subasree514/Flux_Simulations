import csv
import pandas
from cobra.flux_analysis import (
    single_gene_deletion, single_reaction_deletion, double_gene_deletion,
    double_reaction_deletion)
import os
import xml.etree.ElementTree as etree
import cobra
import numpy as np
from itertools import chain
from cobra.util import solver as sutil
from cobra.core.solution import get_solution
from optlang.symbolics import add, Zero
import pandas as pd
import os
from os.path import join
import matplotlib.pyplot as plt
from cobra.medium import minimal_medium
# Press ⌃R to execute it or replace it with your code.
# Press Double ⇧ to search everywhere for classes, files, tool windows, actions, and settings.
from cobra.flux_analysis import production_envelope
import matplotlib.pyplot as plt
from cobra import Model, Reaction, Metabolite
from cobra.io import read_sbml_model
import matplotlib.pyplot as plt
from cobra.flux_analysis import flux_variability_analysis
from cobra.flux_analysis.variability import find_essential_reactions
# Import data manipulation tools
import pandas as pd
import numpy as np
from cobra.io import load_json_model, save_json_model, load_matlab_model, save_matlab_model, read_sbml_model, write_sbml_model

model = cobra.io.load_matlab_model(join(r'/home/subasree/Desktop/curation_alpha_only/core_alpha_model_balanced.mat'))
#model_rs = cobra.io.load_matlab_model(join(r'/home/subasree/Desktop/curation_alpha_only',"modelalpha_loopless.mat"))

## rename the model
core_model=model
print(core_model.groups)


## limiting nutrient analysis
#solutions=[]
#for exchange in core_model.exchanges:
#    core_model = cobra.io.load_matlab_model(join('/Users/subasrees/Desktop/RSmodule/September 24/Sep 16, 2024/Upload_Final/September 28/New Folder/Plant RS/core_model_new.mat'))
#    core_model.reactions.get_by_id(exchange.id).bounds = (-1000, 0)
#    solution = core_model.optimize()
#    solution_update=solution.objective_value
#    solutions.append(solution_update)

#for i in range(0,len(solutions)):
#    print(f'{core_model.exchanges[i]}\tfluxes: {solutions[i]}')

with core_model:
    # Re-define the model's objective
    core_model.objective = 'AraCore_Biomass_tx'
    core_model.reactions.get_by_id('NH4_tx').bounds = (-1000, 0)
    ## Manipulating bounds for exchange reactions - Dark-Night cycle
    #core_model.reactions.get_by_id('Photon_tx').bounds = (0, 0)
    #core_model.reactions.get_by_id('CO2_tx').bounds = (-1000, 0)
    ## Manipulating bounds for exchange reactions - Light-Day cycle
    core_model.reactions.get_by_id('Sucrose_tx').bounds = (-1000, 0)
    core_model.reactions.get_by_id('GLC_tx').bounds = (-1000, 0)
    core_model.reactions.get_by_id('Photon_tx').bounds = (0, 300)

    # Creating object for 3:1 vc/vo
    #rubisco = core_model.problem.Constraint(3 * core_model.reactions.get_by_id("RXN_961_p").flux_expression - core_model.reactions.get_by_id("RIBULOSE_BISPHOSPHATE_CARBOXYLASE_RXN_p").flux_expression,lb=0, ub=0,)
    # Adding to model
    #core_model.add_cons_vars([rubisco])
    # Simulation
    sol = core_model.optimize()
    print(core_model.summary(sol))

    #total = sol.fluxes["RXN_961_p"] + sol.fluxes["RIBULOSE_BISPHOSPHATE_CARBOXYLASE_RXN_p"]
    #print("O2: {}".format(round(sol.fluxes['RXN_961_p']/total*100,2)))
    #print("CO2 : {}".format(round(sol.fluxes['RIBULOSE_BISPHOSPHATE_CARBOXYLASE_RXN_p']/total*100,2)))
    alpha_day_rs=core_model
    save_matlab_model(alpha_day_rs, "alpha_day_rs.mat")

#model=read_sbml_model('/Users/subasrees/Downloads/PlantCoreModel.sbml')

